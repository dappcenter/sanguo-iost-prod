window.__require=function t(e,n,o){function s(r,a){if(!n[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+r+"'")}}var p=n[r]={exports:{}};e[r][0].call(p.exports,function(t){return s(e[r][1][t]||t)},p,p.exports,t,e,n,o)}return n[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<o.length;r++)s(o[r]);return s}({AutoDestroy:[function(t,e,n){"use strict";cc._RF.push(e,"34c83V2HOBChYVmtpjaiXes","AutoDestroy"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=o.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.life=1,e}return __extends(e,t),e.prototype.start=function(){var t=this;setTimeout(function(){t.node.destroy()},1e3*this.life)},__decorate([i],e.prototype,"life",void 0),e=__decorate([s],e)}(cc.Component);n.default=r,cc._RF.pop()},{}],Bar:[function(t,e,n){"use strict";cc._RF.push(e,"9501abCkwFCu7/xP0VfklNu","Bar"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=o.property,r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.red=null,e.redMask=null,e.green=null,e.greenMask=null,e.t=0,e.oldOffset=0,e.offset=0,e.finished=!1,e.duration=.3,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.update=function(t){if(!this.finished)if(this.t+=t,this.t>=this.duration)this.red.node.setPosition(-160+this.offset,0),this.redMask.node.setPosition(160-this.offset,0),this.greenMask.node.setPosition(-this.offset,0),this.green.node.setPosition(this.offset,0),this.finished=!0;else{var e=this.t/this.duration;this.redMask.node.setPosition(160-this.offset*e-this.oldOffset*(1-e),0),this.red.node.setPosition(this.offset*e-160+this.oldOffset*(1-e),0),this.greenMask.node.setPosition(-this.offset*e-this.oldOffset*(1-e),0),this.green.node.setPosition(this.offset*e+this.oldOffset*(1-e),0)}},e.prototype.setValue=function(t){t<0||t>1||(this.oldOffset=this.offset,this.offset=160*(1-t),this.t=0,this.finished=!1)},e.prototype.setValueWithoutAnimation=function(t){t<0||t>1||(this.offset=160*(1-t),this.red.node.setPosition(-160+this.offset,0),this.redMask.node.setPosition(160-this.offset,0),this.greenMask.node.setPosition(-this.offset,0),this.green.node.setPosition(this.offset,0),this.finished=!0)},__decorate([i({type:cc.Sprite})],e.prototype,"red",void 0),__decorate([i({type:cc.Mask})],e.prototype,"redMask",void 0),__decorate([i({type:cc.Sprite})],e.prototype,"green",void 0),__decorate([i({type:cc.Mask})],e.prototype,"greenMask",void 0),e=__decorate([s],e)}(cc.Component);n.default=r,cc._RF.pop()},{}],BattleManager:[function(t,e,n){"use strict";cc._RF.push(e,"e524eQiYflFn4pMxXFzoESc","BattleManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=o.property,r=t("Bar"),a=t("Effect"),c=t("SkillText"),l=t("Unit"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canvas=null,e.enemyPositions=[],e.playerPositions=[],e.barPrefab=null,e.unitPrefab=null,e.effects=[],e.hits=[],e.skills=[],e.skillText=null,e.players=[],e.enemies=[],e.playerBars=[],e.enemyBars=[],e.index2HpMax={},e.isBattleOver=!1,e.onFinish=null,e.UNIT_ID_TO_RESOURCE={1:"heroes/guanyu",2:"heroes/zhangfei",3:"heroes/dianwei",4:"heroes/xiahoudun",5:"heroes/taishici",6:"heroes/sunjian",7:"heroes/ganning",8:"heroes/jianyong",9:"heroes/xunyu",10:"heroes/guojia",11:"heroes/chengong",12:"heroes/chengzhiyuan",13:"heroes/zhaohong",14:"heroes/dengmao",15:"heroes/zhangliang",16:"heroes/zhangbao",17:"heroes/zhangjiao",18:"heroes/huangjinzei",19:"heroes/liubei",20:"heroes/caocao",21:"heroes/lvbu"},e.willSkip=!1,e}return __extends(e,t),e.prototype.start=function(){var t=this;window.battlefield={loadBattleField:function(e,n,o,s){return t.loadBattleField(e,n,o,s)},loadBattleRecords:function(e,n,o,s,i,r,a){return t.loadBattleRecords(e,n,o,s,i,r,a)}}},e.prototype.onDestroy=function(){},e.prototype.update=function(t){},e.prototype.update=function(t){},e.prototype.loadBattleField=function(t,e,n,o){var s=n.length/2;this.loadUnits(n.slice(0,s),n.slice(s)),this.index2HpMax={};for(var i=0;i<t.length;++i)this.index2HpMax[i]=t[i],i<s?this.enemyBars[i]&&this.enemyBars[i].getComponent(r.default).setValueWithoutAnimation(1):this.playerBars[i-s]&&this.playerBars[i-s].getComponent(r.default).setValueWithoutAnimation(1)},e.prototype.loadBattleRecords=function(t,e,n,o,s,i,r){var a=this;this.onFinish=r,__awaiter(a,void 0,void 0,function(){var t;return __generator(this,function(r){switch(r.label){case 0:t=0,r.label=1;case 1:return t<e.length?this.willSkip?[3,4]:[4,this.applySkill(e[t],n[t],o[t],s[t],i[t])]:[3,4];case 2:r.sent(),r.label=3;case 3:return++t,[3,1];case 4:return this.onFinish&&this.onFinish(),[2]}})})},e.prototype.skip=function(){this.willSkip=!0},e.prototype.loadUnits=function(t,e){var n=this;3==t.length&&3==e.length&&(this.enemies=[],this.players=[],this.enemyBars=[],this.playerBars=[],t.map(function(t,e){if(0==t)return n.enemies.push(null),void n.enemyBars.push(null);var o=cc.instantiate(n.unitPrefab);o.parent=n.enemyPositions[e].parent,o.setPosition(n.enemyPositions[e].getPosition()),o.getComponent(l.default).loadResource(n.UNIT_ID_TO_RESOURCE[t]),o.getComponent(l.default).setEnemy(),n.enemies.push(o);var s=cc.instantiate(n.barPrefab);o.getComponent(l.default).attachToMe(s),s.setPosition(cc.v2(0,-110)),n.enemyBars.push(s)}),e.map(function(t,e){if(0==t)return n.players.push(null),void n.playerBars.push(null);var o=cc.instantiate(n.unitPrefab);o.parent=n.playerPositions[e].parent,o.setPosition(n.playerPositions[e].getPosition()),o.getComponent(l.default).loadResource(n.UNIT_ID_TO_RESOURCE[t]),n.players.push(o);var s=cc.instantiate(n.barPrefab);o.getComponent(l.default).attachToMe(s),s.setPosition(cc.v2(0,-110)),n.playerBars.push(s)}))},e.prototype.applySkill=function(t,e,n,o,s){return __awaiter(this,void 0,void 0,function(){var i,a,p,u,f,h;return __generator(this,function(d){switch(d.label){case 0:return t?(i=this.players[e],a=this.enemies[n]):(i=this.enemies[n],a=this.players[e]),i.getComponent(l.default).setStatus(1,!1),0==o?[3,3]:(i.getComponent(cc.Animation).play("status_00"),[4,this.waitFor(.5)]);case 1:return d.sent(),this.skillText.getComponent(c.default).play(o),[4,this.waitFor(.5)];case 2:d.sent(),d.label=3;case 3:return 0!=o&&1!=o&&2!=o&&3!=o&&4!=o&&5!=o&&7!=o&&16!=o&&17!=o?[3,11]:[4,this.playSkillEffect(i,a)];case 4:return d.sent(),1!=s.length?[3,8]:[4,this.playHitEffect([a])];case 5:return d.sent(),p=s[0],u=this.index2HpMax[t?n:this.enemyPositions.length+e],t?(this.enemyBars[n].getComponent(r.default).setValue(p/u),0==p&&(a.getComponent(l.default).killMe(),delete this.enemies[n])):(this.playerBars[e].getComponent(r.default).setValue(p/u),0==p&&(a.getComponent(l.default).killMe(),delete this.players[e])),p>0?5!=o&&17!=o?[3,7]:[4,a.getComponent(l.default).setStatus(1,!0)]:[3,7];case 6:d.sent(),d.label=7;case 7:return[3,10];case 8:return s.length>1?[4,this.playHitEffect(t?this.enemies:this.players)]:[3,10];case 9:for(d.sent(),h=0;h<s.length;++h)if(p=s[h],u=this.index2HpMax[t?h:this.enemyPositions.length+h],t){if(!this.enemies[h])continue;this.enemyBars[h].getComponent(r.default).setValue(p/u),0==p&&(this.enemies[h].getComponent(l.default).killMe(),delete this.enemies[h])}else{if(!this.players[h])continue;this.playerBars[h].getComponent(r.default).setValue(p/u),0==p&&(this.players[h].getComponent(l.default).killMe(),delete this.players[h])}d.label=10;case 10:return[3,22];case 11:return 6!=o?[3,13]:[4,i.getComponent(l.default).showText("+\u654f\u6377")];case 12:return d.sent(),[3,22];case 13:return 8!=o?[3,15]:[4,a.getComponent(l.default).showText("-\u9632\u5fa1")];case 14:return d.sent(),[3,22];case 15:return 9!=o?[3,17]:[4,a.getComponent(l.default).showText("-\u654f\u6377")];case 16:return d.sent(),[3,22];case 17:return 10!=o&&12!=o&&13!=o&&15!=o?[3,18]:(u=this.index2HpMax[t?this.enemyPositions.length+n:e],t?(this.playerBars[n].getComponent(r.default).setValue(s[0]/u),this.players[n].getComponent(l.default).showText("\u6cbb\u7597")):(this.enemyBars[e].getComponent(r.default).setValue(s[0]/u),this.enemies[e].getComponent(l.default).showText("\u6cbb\u7597")),[3,22]);case 18:if(11!=o)return[3,20];if(f=[],t)for(h=0;h<this.players.length;++h)this.players[h]&&f.push(this.players[h].getComponent(l.default).showText("+\u654f\u6377"));else for(h=0;h<this.enemies.length;++h)this.enemies[h]&&f.push(this.enemies[h].getComponent(l.default).showText("+\u654f\u6377"));return[4,Promise.all(f)];case 19:return d.sent(),[3,22];case 20:if(14!=o)return[3,22];for(f=[],h=0;h<3;++h)t&&this.enemies[h]?f.push(this.players[h].getComponent(l.default).setStatus(1,!0)):!t&&this.players[h]&&f.push(this.players[h].getComponent(l.default).setStatus(1,!0));return[4,Promise.all(f)];case 21:d.sent(),d.label=22;case 22:return[4,this.waitFor(1)];case 23:return d.sent(),[2]}})})},e.prototype.playSkillEffect=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,o,s,i,r,c,l;return __generator(this,function(p){switch(p.label){case 0:return n=t.parent.convertToWorldSpaceAR(t.position),o=this.skills[0].split(","),s=o[0],i=this.effects[1*o[1]],r=1*o[3],t.getComponent(cc.Animation).play(s),[4,this.waitFor(r)];case 1:return p.sent(),e&&e.parent&&((c=cc.instantiate(i)).parent=this.node.parent,c.setPosition(n),c.getComponent(a.default)&&(l=e.parent.convertToWorldSpaceAR(e.position),c.getComponent(a.default).fly(n,l,t1))),[2]}})})},e.prototype.playHitEffect=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,o,s,i,r;return __generator(this,function(a){switch(a.label){case 0:return e=this.skills[0].split(","),n=this.hits[1*e[2]],o=1*e[4],[4,this.waitFor(o)];case 1:for(a.sent(),s=0;s<t.length;++s)t[s]&&t[s].parent&&(i=t[s].parent.convertToWorldSpaceAR(t[s].position),t[s].getComponent(cc.Animation).play("unit_hit_00"),(r=cc.instantiate(n)).parent=this.node.parent,r.setPosition(i));return[2]}})})},e.prototype.waitFor=function(t){var e=this;return new Promise(function(n,o){e.scheduleOnce(function(){n()},t)})},__decorate([i({type:cc.Node})],e.prototype,"canvas",void 0),__decorate([i({type:[cc.Node]})],e.prototype,"enemyPositions",void 0),__decorate([i({type:[cc.Node]})],e.prototype,"playerPositions",void 0),__decorate([i({type:cc.Prefab})],e.prototype,"barPrefab",void 0),__decorate([i({type:cc.Prefab})],e.prototype,"unitPrefab",void 0),__decorate([i({type:[cc.Prefab]})],e.prototype,"effects",void 0),__decorate([i({type:[cc.Prefab]})],e.prototype,"hits",void 0),__decorate([i({type:[cc.String]})],e.prototype,"skills",void 0),__decorate([i({type:cc.Node})],e.prototype,"skillText",void 0),e=__decorate([s],e)}(cc.Component);n.default=p,cc._RF.pop()},{Bar:"Bar",Effect:"Effect",SkillText:"SkillText",Unit:"Unit"}],Effect:[function(t,e,n){"use strict";cc._RF.push(e,"2b1808enq9ELLTXMBbBKK2y","Effect"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._from=null,e._to=null,e._life=0,e._t=0,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.update=function(t){if(!(null==this._from||this._life<=0))if(this._t-=t,this._t<=0)this.node.destroy();else{var e=this._t/this._life,n=this._from.x*e+this._to.x*(1-e),o=this._from.y*e+this._to.y*(1-e);this.node.setPosition(cc.v2(n,o))}},e.prototype.fly=function(t,e,n){this._from=t,this._to=e,this._life=n,this._t=n},e=__decorate([s],e)}(cc.Component));n.default=i,cc._RF.pop()},{}],SkillText:[function(t,e,n){"use strict";cc._RF.push(e,"3a8devW28dEOq3GsZJ9LSKY","SkillText"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=(o.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SKILL_ARRAY={1:"\u9752\u9f99\u5043\u6708",2:"\u65ad\u6865\u4e4b\u6012",3:"\u72c2\u66b4\u4e4b\u5203",4:"\u566c\u76ee\u4e00\u51fb",5:"\u8d2f\u624b\u7740\u68fc",6:"\u60ca\u6d9b\u9a87\u6d6a",7:"\u4e34\u5371\u4e0d\u60e7",8:"\u5de6\u53f3\u9022\u6e90",9:"\u575a\u58c1\u6e05\u91ce",10:"\u8fd0\u7b79\u5e37\u5e44",11:"\u6fc0\u6d41\u52c7\u8fdb",12:"\u89c6\u6b7b\u5982\u5f52",13:"\u795e\u5175\u5929\u964d",14:"\u5341\u6708\u56f4\u57ce",15:"\u82cd\u5929\u5df2\u6b7b",16:"\u9ec4\u5929\u5f53\u7acb",17:"\u5929\u4e0b\u5927\u5409"},e}return __extends(e,t),e.prototype.start=function(){},e.prototype.play=function(t){this.getComponent(cc.Label).string=this.SKILL_ARRAY[t]||"",this.getComponent(cc.Animation).play("skill_text")},e=__decorate([s],e)}(cc.Component));n.default=i,cc._RF.pop()},{}],StatusText:[function(t,e,n){"use strict";cc._RF.push(e,"304afTwfJpDyZzWFFpBxTmM","StatusText"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){},e.prototype.setContent=function(t){this.getComponent(cc.Label).string=t},e=__decorate([s],e)}(cc.Component));n.default=i,cc._RF.pop()},{}],Unit:[function(t,e,n){"use strict";cc._RF.push(e,"f3da9BWeGBEg4+NskGsooiz","Unit"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,s=o.ccclass,i=o.property,r=t("StatusText"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.tombstonePrefab=null,e.stunnedPrefab=null,e.statusTextPrefab=null,e.currentStatus=0,e}return __extends(e,t),e.prototype.start=function(){},e.prototype.update=function(t){},e.prototype.setEnemy=function(){},e.prototype.loadResource=function(t){var e=this;cc.loader.loadRes(t,cc.SpriteFrame,function(t,n){e.sprite.spriteFrame=n})},e.prototype.attachToMe=function(t){t.parent=this.sprite.node},e.prototype.killMe=function(){var t=this;this.effect&&this.effect.destroy();var e=this.getComponent(cc.Animation),n=e.getAnimationState("death");e.on("finished",function(e,o){if(o==n){var s=cc.instantiate(t.tombstonePrefab);s.parent=t.node.parent,s.setPosition(t.node.getPosition()),t.node.destroy()}}),e.play("death")},e.prototype.setStatus=function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return e?1!=t?[3,2]:(this.effect&&this.effect.destroy(),this.effect=cc.instantiate(this.stunnedPrefab),this.effect.parent=this.node.parent,this.effect.setPosition(this.node.getPosition()),this.currentStatus=1,[4,this.waitFor(.5)]):(this.currentStatus==t&&this.effect&&(this.effect.destroy(),this.effect=null,this.currentStatus=0),[2]);case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.showText=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return(e=cc.instantiate(this.statusTextPrefab)).parent=this.node.parent,e.setPosition(this.node.getPosition()),e.getComponent(r.default).setContent(t),[4,this.waitFor(1)];case 1:return n.sent(),[2]}})})},e.prototype.waitFor=function(t){var e=this;return new Promise(function(n,o){e.scheduleOnce(function(){n()},t)})},__decorate([i({type:cc.Sprite})],e.prototype,"sprite",void 0),__decorate([i({type:cc.Prefab})],e.prototype,"tombstonePrefab",void 0),__decorate([i({type:cc.Prefab})],e.prototype,"stunnedPrefab",void 0),__decorate([i({type:cc.Prefab})],e.prototype,"statusTextPrefab",void 0),e=__decorate([s],e)}(cc.Component);n.default=a,cc._RF.pop()},{StatusText:"StatusText"}]},{},["BattleManager","AutoDestroy","Bar","Effect","SkillText","StatusText","Unit"]);